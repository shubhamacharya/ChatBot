<html lang="en" class="active">
   <head>
      <!-- Required meta tags -->
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <!-- Latest compiled and minified JavaScript -->
      <!-- Bootstrap CSS -->
      <link rel="stylesheet" href="/./static/stylesheet.css">
      <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
      <title>Admin</title>
   </head>
   <body class="">
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.4.13/dist/sweetalert2.all.min.js"></script>
      <script src="static/script.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <!--Admin Navbar-->
      <nav class="navbar navbar-expand-sm py-0 navbar-dark bg-dark">
         <div class="container-fluid">
            <a class="navbar-brand" href="/admin">ChatterBot</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavDropdown" aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavDropdown">
               <ul class="navbar-nav">
                  <li class="nav-item dropdown">
                     <a class="nav-link dropdown-toggle" href="#" id="navbarDropdownMenuLink" type="button" role="button"  aria-expanded="false">
                     Options
                     </a>
                     <ul class="dropdown-menu" aria-labelledby="navbarDropdownMenuLink">
                        {% if user['role'] == 'superAdmin' %}
                        <li>
                           <form method="GET" class="dropdown-item" action="/register"><button class="hidden-btn" type="submit">Add Admin</button></form>
                        </li>
                        {% endif %}
                        <li><button class="hidden-btn" onclick="changePasswd()">Change Password</button></li>
                        <li>
                           <form method="POST" class="dropdown-item" action="/logout"><button class="hidden-btn">Logout</button></form>
                        </li>
                     </ul>
                  </li>
               </ul>
            </div>
         </div>
      </nav>
      <!--Admin Navbar End-->
      <div class="d-flex align-items-start">
         <div class="split-left nav flex-column nav-pills me-3" id="v-pills-tab" role="tablist" aria-orientation="vertical">
            <button class="nav-link active first" id="v-pills-home-tab" data-bs-toggle="pill" data-bs-target="#v-pills-home" type="button" role="tab" aria-controls="v-pills-home" aria-selected="true">Home</button>
            <button class="nav-link first" id="v-pills-add-question-tab" data-bs-toggle="pill" data-bs-target="#v-pills-add-question" type="button" role="tab" aria-controls="v-pills-add-question" aria-selected="false">Add Question</button>
            {% if user['role'] == 'superAdmin'%}
            <button class="nav-link first" id="v-pills-approve-tab" data-bs-toggle="pill" data-bs-target="#v-pills-approve" type="button" role="tab" aria-controls="v-pills-approve" aria-selected="false">Approve Question</button>
            {% else %}
            <button class="nav-link first" id="v-pills-messages-tab" data-bs-toggle="pill" data-bs-target="#v-pills-messages" type="button" role="tab" aria-controls="v-pills-messages" aria-selected="false">Answer Questions</button>
            {% endif %}
            <button class="nav-link first" id="v-pills-edit-tab" data-bs-toggle="pill" data-bs-target="#v-pills-edit" type="button" role="tab" aria-controls="v-pills-edit" aria-selected="false">Edit Question</button>
         </div>
         <div class="tab-content split-right" id="v-pills-tabContent">
            <div class="tab-pane fade show active" id="v-pills-home" role="tabpanel" aria-labelledby="v-pills-home-tab" > Home
            </div>
            <!--Add Question to chatbot-->
            <div class="tab-pane fade" id="v-pills-add-question" role="tabpanel" aria-labelledby="v-pills-add-question-tab">
               <form name="addQuestion" action="/addQuestion" method="post">
                  <div class="card">
                     <div class="card-body">
                        <div class="mb-3">
                           <label for="addQuestions" class="form-label">Enter Questions Here</label>
                           <textarea class="form-control" id="addQuestions" placeholder="Enter questions sepearated by lines" name="questions" rows="3"></textarea>
                        </div>
                        <div class="mb-3">
                           <label for="addQuestionAnswer" class="form-label">Enter Answer Here</label>
                           <input class="form-control" name="answer" id="addQuestionAnswer" type="text" name="addQuestionAnswer">
                        </div>
                        <select class="form-select" name="tags" id="tags" aria-label="Default select example">
                           <option selected disabled>Select Tag</option>
                           {% for tag in tags %}
                           <option value= {{ tag }}>{{ tag }}</option>
                           {% endfor %}
                           <option value="nota">Not Present</option>
                        </select>
                        <div id="addNewTag" style="display: none">
                           Add New Tag:
                           <input class="form-control" name="newTag" id="newTag" type="text" placeholder="Enter New Tag Here.">
                        </div>
                        <script type="text/javascript">
                           //Shows the Add New Tag if Not Present Option is Selected.
                           $("#tags").on('change',function () {
                             if(this.value == 'nota')
                             {
                               $('#addNewTag').show();
                             }
                             else
                             {
                               $('#addNewTag').hide();
                             }
                           });
                        </script>
                        <div class="text-center">
                           <button class="btn btn-primary btn-lg submit" type="submit" name="submit" value="submit">Submit</button>
                        </div>
                     </div>
                  </div>
               </form>
            </div>
            <!--Add Question to chatbot END-->
            {% if user['role'] == 'superAdmin'%}
            <!-- Approve Question for Main Admins -->
            <div class="tab-pane fade" id="v-pills-approve" role="tabpanel" aria-labelledby="v-pills-approve-tab">
               <nav>
                  <div class="nav nav-tabs" id="nav-tab" role="tablist">
                    <button class="nav-link active" id="nav-added-tab" data-bs-toggle="tab" data-bs-target="#nav-added" type="button" role="tab" aria-controls="nav-added" aria-selected="true">Approve Added</button>
                    <button class="nav-link" id="nav-answered-tab" data-bs-toggle="tab" data-bs-target="#nav-answered" type="button" role="tab" aria-controls="nav-answered" aria-selected="false">Approve Answered</button>
                    <button class="nav-link" id="nav-updated-tab" data-bs-toggle="tab" data-bs-target="#nav-updated" type="button" role="tab" aria-controls="nav-updated" aria-selected="false">Approve Updated</button>
                  </div>
                </nav>
                <div class="tab-content" id="nav-tabContent">

                  <!--Approve Added Start -->
                     <div class="tab-pane fade show active" id="nav-added" role="tabpanel" aria-labelledby="nav-added-tab">...</div>
                  <!--Approve Added End -->

                  <!--Approve Answered Start-->
                     <div class="tab-pane fade" id="nav-answered" role="tabpanel" aria-labelledby="nav-answered-tab">
                        {% if unanswered%}
                           <table class="table table-striped table-hover">
                              <thead>
                                 <td>Id.</td>
                                 <td>Question</td>
                                 <td>Response</td>
                                 <td>Tag</td>
                                 <td>Admin Id</td>
                                 <td>Opeation</td>
                              </thead>
                              {% for i in range(count) %}
                                 <tr>
                                    <form action='/unanswered' method='POST'>
                                       <td> {{i+1}}.</td>
                                       <td> <input readonly value="{{unanswered[i][0]}}" name="question"></td>
                                       <td> <input readonly value="{{unanswered[i][1]}}" name="addAnswer"></td>
                                       <td> <input readonly value="{{unanswered[i][2]}}" name="addAnsTags"></td>
                                       <td> {{unanswered[i][3]}}</td>
                                       <td>
                                          <div class="btn-group" role="group" aria-label="Basic radio toggle button group">
                                             <input type="radio" class="btn-check" name="btnradio" value="Approved" id="btnradio1" autocomplete="off">
                                             <label class="btn btn-outline-primary" for="btnradio1">Approve</label>
                                             <input type="radio" class="btn-check" name="btnradio" value="Declined" id="btnradio2" autocomplete="off">
                                             <label class="btn btn-outline-primary" for="btnradio2">Declined</label>
                                          </div>
                                       </td>
                                       <td><button type="submit" name="submit">Send</button></td>
                                    </form>
                                 </tr>
                              {% endfor %}
                           </table>    
                        {% else %}
                           <h3>No Questions for Approval</h3>
                        {% endif %}
                     </div>
                  <!--Approve Answered End-->

                  <!--Approve Updated Start-->
                     <div class="tab-pane fade" id="nav-updated" role="tabpanel" aria-labelledby="nav-updated-tab">...</div>
                  <!--Approve Updated End-->
                  </div>
            </div>
            <!-- Approve Question for Main Admins End -->
            {% else %}
            <!-- Answer Questions -->
            <div class="tab-pane fade" id="v-pills-messages" role="tabpanel" aria-labelledby="v-pills-messages-tab">
               {% if unanswered %}
               <div class="accordion accordion-flush" id="accordionFlushExample">
                  {% for i in range(count) %}
                  <div class="accordion-item">
                     <h2 class="accordion-header" id="flush-heading{{i}}">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapse{{i}}" aria-expanded="false" aria-controls="flush-collapse{{i}}">
                        {{unanswered[i]}}
                        </button>
                     </h2>
                     <div id="flush-collapse{{i}}" class="accordion-collapse collapse" aria-labelledby="flush-heading{{i}}" data-bs-parent="#accordionFlushExample">
                        <form action="/unanswered" method="post">
                           <div class="mb-3">
                              <input name="question" value="{{unanswered[i]}}" readonly></input><br><br>
                              <label for="addAnswer" class="form-label">Enter Answer Here</label>
                              <input class="form-control" id="addAnswer" type="text" name="addAnswer">
                           </div>
                           <select class="form-select" name="addAnsTags" id="addAnsTags" aria-label="Default select example">
                              <option selected disabled>Select Tag</option>
                              {% for tag in tags %}
                              <option value= {{ tag }}>{{ tag }}</option>
                              {% endfor %}
                              <option value="nota">Not Present</option>
                           </select>
                           <div id="addAnsNewTag" style="display: none">
                              Add New Tag:
                              <input class="form-control" name="addNewAnsTags" id="addNewAnsTags" type="text" placeholder="Enter New Tag Here.">
                           </div>
                           <script type="text/javascript">
                              //Shows the Add New Tag if Not Present Option is Selected.
                              $("#addAnsTags").on('change',function () {
                                if(this.value == 'nota')
                                {
                                  $('#addAnsNewTag').show();
                                }
                                else
                                {
                                  $('#addAnsNewTag').hide();
                                }
                              });
                           </script>
                           <div class="text-center">
                              <button class="btn btn-primary btn-lg submit" type="submit" name="submit" value="submit">Submit</button>
                           </div>
                        </form>
                     </div>
                  </div>
                  {% endfor %}
               </div>
               {% else %}
               <h3>No Questions to answer</h3>
               {% endif %}
            </div>
            <!-- Answer Questions End-->
            {% endif %}
            <!--Edit Question-->
            <div class="tab-pane fade" id="v-pills-edit" role="tabpanel" aria-labelledby="v-pills-edit-tab">
               <form>
                  <div class="card">
                     <div class="card-body">
               <form class="form-inline">
               <select name="searchTag" id="searchTag" class="box mdb-select md-form">
               <option value="" disabled selected>Select Tag</option>
               {%for tag in tags%}
               <option value="{{tag}}">{{tag}}</option>
               {% endfor %}
               </select><br>
               <div class="search_select_box">
               <input class="form-control" list="datalistOptions" name="datalistOptionsInput" id="datalistOptionsInput" placeholder="Type to search...">
               <datalist id="datalistOptions">
               </datalist>
               </div>
               <button type="button" onclick="getEdit()" id="editQuestionBtn" class="btn btn-primary">Edit</button>
               <span id="questionTest"></span>
               </form>
               <input type="text" class="form-control" id="editableQuestion"></input>
               <textarea class="form-control" id="responsesTextarea" rows="3"></textarea>
               <button type="button" onclick="updateQuestion()" id="updateQuestionBtn" class="btn btn-primary">Update</button>
               </div>
               </div>
               </form>
               <script type="text/javascript">
                  var responses;
                  var questionChange = false;
                  var responseChange = false;
                  
                  $("#searchTag").on('change',function () {
                    var tag = this.value
                    var url = "/api/tag?tag="+tag
                    fetch(url).then((response) => {
                      return response.json();
                    }).then((data) =>
                    {
                        $('#datalistOptions option').remove()
                        response = data.responses;
                        for(let que in data.patterns)
                        {
                          $('#datalistOptions').append($(document.createElement('option')).prop({
                            value: data.patterns[que],
                            text: data.patterns[que]
                          }))
                        }
                    })
                  });
                  
                  $("#editableQuestion").on("change",() => {
                    questionChange = true
                  })
                  
                  $("#responsesTextarea").on("change",() => {
                    responseChange = true
                  })
                  
               </script>
            </div>
            <!--Edit Question End-->
         </div>
      </div>
   </body>
</html>